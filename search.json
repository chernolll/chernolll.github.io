[{"title":"mapboxglå®æ—¶æ›´æ–°10wç‚¹","url":"/2025/08/08/mapboxgl%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B010w%E7%82%B9/","content":"&lt;!DOCTYPE html&gt;&lt;html lang=&quot;zh-CN&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;    &lt;title&gt;Mapbox GL | 10ä¸‡ç‚¹å®æ—¶é¢œè‰²æ›´æ–°&lt;/title&gt;    &lt;link      href=&quot;https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css&quot;      rel=&quot;stylesheet&quot;    /&gt;    &lt;script src=&quot;https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js&quot;&gt;&lt;/script&gt;    &lt;style&gt;      html,      body,      #map &#123;        height: 100%;        margin: 0;      &#125;      #panel &#123;        position: absolute;        top: 10px;        left: 10px;        z-index: 10;        background: rgba(0, 0, 0, 0.6);        color: white;        padding: 10px;        border-radius: 8px;      &#125;    &lt;/style&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div id=&quot;map&quot;&gt;&lt;/div&gt;    &lt;div id=&quot;panel&quot;&gt;10ä¸‡ç‚¹ï¼Œé¢œè‰²å®æ—¶æ›´æ–°ï¼ˆfeature-stateï¼‰&lt;/div&gt;    &lt;script&gt;      mapboxgl.accessToken =        &quot;pk.eyJ1Ijoic3NpdmFsZW4iLCJhIjoiY205N3J1OWw5MGFoNzJscHQ2cjA1N21qcCJ9.KA0V5-Mh_KCV4DV5HkpAeg&quot;;      const map = new mapboxgl.Map(&#123;        container: &quot;map&quot;,        style: &quot;mapbox://styles/mapbox/dark-v11&quot;,        center: [116.397, 39.908],        zoom: 9,        renderWorldCopies: false,      &#125;);      map.on(&quot;load&quot;, () =&gt; &#123;        // 1. æ·»åŠ  sourceï¼Œä½¿ç”¨ promoteId        map.addSource(&quot;points&quot;, &#123;          type: &quot;geojson&quot;,          data: &#123; type: &quot;FeatureCollection&quot;, features: [] &#125;,          promoteId: &quot;id&quot;,          cluster: false,        &#125;);        // 2. æ·»åŠ å›¾å±‚ï¼Œé¢œè‰²ç”¨ feature-state.v        map.addLayer(&#123;          id: &quot;points-layer&quot;,          type: &quot;circle&quot;,          source: &quot;points&quot;,          paint: &#123;            &quot;circle-color&quot;: [              &quot;interpolate&quot;,              [&quot;linear&quot;],              [&quot;coalesce&quot;, [&quot;feature-state&quot;, &quot;v&quot;], 0], // state.vä¸å­˜åœ¨æ—¶ç”¨0              0.0,              &quot;#2DC4B2&quot;,              0.25,              &quot;#3BB3C3&quot;,              0.5,              &quot;#669EC4&quot;,              0.75,              &quot;#8B88B6&quot;,              1.0,              &quot;#A2719B&quot;,            ],            &quot;circle-radius&quot;: [              &quot;let&quot;,              &quot;r&quot;,              [&quot;coalesce&quot;, [&quot;get&quot;, &quot;r&quot;], 2],              [                &quot;interpolate&quot;,                [&quot;linear&quot;],                [&quot;zoom&quot;],                3,                [&quot;*&quot;, [&quot;var&quot;, &quot;r&quot;], 0.7],                12,                [&quot;*&quot;, [&quot;var&quot;, &quot;r&quot;], 1.4],              ],            ],            &quot;circle-opacity&quot;: 0.8,          &#125;,        &#125;);        // 3. ç”Ÿæˆ 10 ä¸‡ç‚¹æ•°æ®ï¼ˆå¸¦ idï¼‰        const N = 100000;        const features = [];        for (let i = 0; i &lt; N; i++) &#123;          features.push(&#123;            type: &quot;Feature&quot;,            id: i, // id å­—æ®µï¼Œä¸ promoteId å¯¹åº”            properties: &#123; id: i &#125;,            geometry: &#123;              type: &quot;Point&quot;,              coordinates: [                116.0 + Math.random(), // ç»åº¦                39.5 + Math.random(), // çº¬åº¦              ],            &#125;,          &#125;);        &#125;        map          .getSource(&quot;points&quot;)          .setData(&#123; type: &quot;FeatureCollection&quot;, features &#125;);        // 4. æ¨¡æ‹Ÿå®æ—¶é¢œè‰²æ›´æ–°ï¼ˆæ¯å¸§æ”¹ 2000 ä¸ªç‚¹ï¼‰        function randomUpdate() &#123;          for (let k = 0; k &lt; 2000; k++) &#123;            const id = Math.floor(Math.random() * N);            const v = Math.random();            map.setFeatureState(&#123; source: &quot;points&quot;, id &#125;, &#123; v &#125;);          &#125;          requestAnimationFrame(randomUpdate);        &#125;        randomUpdate();        // å¦‚æœæ˜¯ WebSocketï¼Œç›´æ¥åœ¨ onmessage é‡Œè°ƒç”¨ setFeatureState(&#123;source:&#x27;points&#x27;,id&#125;,&#123;v&#125;)      &#125;);    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;\n","tags":["mapboxgl"]},{"title":"æ–‡å­—é›¨æ•ˆæœåŸç†è§£æä¸å®ç°","url":"/2025/08/11/canvas-%E6%96%87%E5%AD%97%E9%9B%A8/","content":"\nâ€œé›¨ç‚¹èˆ¬çš„å­—ç¬¦è½ä¸‹ï¼Œåƒã€Šé»‘å®¢å¸å›½ã€‹é‡Œçš„æ•°å­—ä¸–ç•Œåœ¨æµåŠ¨ã€‚â€æœ¬æ–‡å°†å¸¦ä½ ä» 0 åˆ° 1 å®ç°ä¸€ä¸ª Canvas æ–‡å­—é›¨æ•ˆæœï¼Œå¹¶æ·±å…¥è§£æå®ƒçš„åŠ¨ç”»åŸç†ã€‚\n\næ•ˆæœé¢„è§ˆ\næ ¸å¿ƒä»£ç /** @type &#123;HTMLCanvasElement&#125; */const canvas = document.querySelector(&quot;#canvas&quot;);const ctx = canvas.getContext(&quot;2d&quot;);const ratio = window.devicePixelRatio;const w = window.innerWidth * ratio;const h = window.innerHeight * ratio;canvas.width = w;canvas.height = h;const fontSize = 10 * ratio;ctx.font = `$&#123;fontSize&#125;px &quot;Roboto Mono&quot;`;const columnCount = Math.floor(w / fontSize);const charIndex = new Array(columnCount).fill(0);function getRandomChar() &#123;  const str = &quot;0123456789abcdefghijklmnopqrltuvwxyz&quot;;  return str[Math.floor(Math.random() * str.length)];&#125;function draw() &#123;  // 1. åŠé€æ˜å¹•å¸ƒï¼Œè®©æ—§æ–‡å­—é€æ¸å˜æš—  ctx.fillStyle = &quot;rgba(0, 0, 0, 0.1)&quot;;  ctx.fillRect(0, 0, w, h);  // 2. ç”»æ–°æ–‡å­—  ctx.fillStyle = &quot;#6be445&quot;;  ctx.textBaseline = &quot;top&quot;;  for (let i = 0; i &lt; columnCount; i++) &#123;    const text = getRandomChar();    const x = i * fontSize;    const y = charIndex[i] * fontSize;    ctx.fillText(text, x, y);    if (y &gt; h &amp;&amp; Math.random() &gt; 0.99) &#123;      charIndex[i] = 0;    &#125; else &#123;      charIndex[i]++;    &#125;  &#125;  // æ­¤å¤„æ”¹ä¸ºç”¨setTimeoutå»¶è¿Ÿæ‰§è¡Œï¼Œè¿™æ ·æ•ˆæœçœ‹èµ·æ¥å¥½ä¸€ç‚¹  window.setTimeout(draw, 50);  // requestAnimationFrame(draw);&#125;draw();\n\nåŸç†è§£ææ–‡å­—é›¨çš„åŠ¨ç”»ä¸»è¦ä¾èµ–ä¸¤ä¸ªå…³é”®æŠ€å·§ï¼š\n1. åŠé€æ˜å¹•å¸ƒå åŠ æ¯ä¸€å¸§å…ˆç”¨ rgba(0,0,0,0.1) è¿™æ ·çš„åŠé€æ˜é¢œè‰²å¡«å……æ•´ä¸ªç”»å¸ƒï¼š\nctx.fillStyle = &quot;rgba(0, 0, 0, 0.1)&quot;;ctx.fillRect(0, 0, w, h);\n\n\nä½œç”¨ï¼šä¸æ˜¯ä¸€æ¬¡æ€§æ¸…ç©ºç”»å¸ƒï¼Œè€Œæ˜¯è®©ä¹‹å‰çš„å†…å®¹é€æ¸å˜æš—\næ•ˆæœï¼šå½¢æˆâ€œå°¾è¿¹â€ï¼Œçœ‹èµ·æ¥åƒå­—ç¬¦å¸¦ç€æ®‹å½±ä¸‹è½\nå¦‚æœé€æ˜åº¦&#x3D;1ï¼šæ—§å†…å®¹ä¼šä¸€æ¬¡æ€§æ¶ˆå¤±ï¼Œæ²¡æœ‰æµåŠ¨æ„Ÿ\n\n2. åˆ—ä½ç½®ä¸å­—ç¬¦è½ä¸‹\næŒ‰åˆ—è®¡ç®— columnCountï¼Œæ¯åˆ—ç‹¬ç«‹æ§åˆ¶ä¸€ä¸ªå­—ç¬¦çš„çºµå‘ä½ç½®\næ¯ä¸€å¸§åœ¨è¯¥åˆ—çš„ä¸‹ä¸€è¡Œç»˜åˆ¶ä¸€ä¸ªæ–°å­—ç¬¦\nå½“å­—ç¬¦åˆ°åº•éƒ¨åï¼Œä»¥ä¸€å®šæ¦‚ç‡é‡æ–°ä»é¡¶éƒ¨å¼€å§‹è½ä¸‹\n\n3. é¢œè‰²ä¸å­—ä½“\nç»¿è‰²å­—ç¬¦ï¼šctx.fillStyle = &quot;#6be445&quot;\nå•ä¸€å­—ä½“ï¼šä¿è¯åˆ—å®½å’Œå­—ç¬¦å¯¹é½\nå¯ä»¥æ”¹æˆä»»æ„å­—ç¬¦é›†ï¼ˆæ¯”å¦‚æ—¥æ–‡å‡åã€emojiï¼‰\n\nä¼˜åŒ–å»ºè®®\nåœ¨é«˜ DPI å±å¹•ä¸Šä½¿ç”¨ window.devicePixelRatioï¼Œé˜²æ­¢æ¨¡ç³Š\næ§åˆ¶ requestAnimationFrame çš„ç»˜åˆ¶é¢‘ç‡ï¼Œé™ä½ CPU å ç”¨\nä½¿ç”¨æ›´é«˜é€æ˜åº¦ï¼ˆå¦‚ 0.05ï¼‰è·å¾—æ›´é•¿çš„å°¾è¿¹æ•ˆæœ\n\næ€»ç»“æ–‡å­—é›¨çš„é…·ç‚«æ•ˆæœå¹¶ä¸å¤æ‚ï¼Œå…³é”®æ˜¯åŠé€æ˜å¹•å¸ƒ + æŒ‰åˆ—è½ä¸‹çš„å­—ç¬¦é€»è¾‘ã€‚ç†è§£äº†è¿™ä¸ªåŸç†ï¼Œä½ è¿˜å¯ä»¥ç”¨å®ƒåšæ˜Ÿç©ºã€çƒŸé›¾ã€ç²’å­å°¾è¿¹ç­‰å„ç§ç‰¹æ•ˆã€‚\n\nğŸ¬ æ‹“å±•é˜…è¯»ï¼š\n\nMDN CanvasRenderingContext2D æ–‡æ¡£\nrequestAnimationFrame\n\n","tags":["canvas"]},{"title":"mapboxç¯‡-åŠ¨æ€é—ªçƒç‚¹ä¸èšç±»åŠ¨ç”»æ•ˆæœ","url":"/2025/07/31/mapbox%E7%AF%87-%E5%8A%A8%E6%80%81%E9%97%AA%E7%83%81%E7%82%B9%E4%B8%8E%E8%81%9A%E7%B1%BB%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C/","content":"Mapbox GL åŸç”Ÿæ”¯æŒåŠ¨æ€å›¾æ ‡æ¸²æŸ“ï¼Œæœ¬ç¯‡é€šè¿‡ä¸€ä¸ªæœ€å°å¯è¿è¡Œ HTML ç¤ºä¾‹å±•ç¤ºäº†ä»¥ä¸‹åŠŸèƒ½ï¼š\n\nè‡ªå®šä¹‰åŠ¨ç”»å›¾æ ‡ï¼šåŠ¨æ€é—ªçƒçš„è„‰å†²ç‚¹ï¼›\nåŠ¨æ€ç‚¹èšç±»æ•ˆæœï¼šé¢œè‰²ä¸åŠå¾„éšæ•°é‡å˜åŒ–ï¼›\nçº¯åŸç”Ÿ HTML å’Œ JavaScriptï¼Œæ— éœ€æ¡†æ¶ï¼›\næ”¯æŒæµ·é‡ç‚¹æ¸²æŸ“ä¸åŠ¨ç”»å…±å­˜ï¼›\n\nğŸ” æ ¸å¿ƒåŠŸèƒ½è§£è¯»ğŸ”´ åŠ¨æ€é—ªçƒç‚¹å›¾æ ‡ï¼ˆPulsing Dotï¼‰ä½¿ç”¨ map.addImage æ·»åŠ ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ Canvas å›¾æ ‡ï¼š\nconst pulsingDot = &#123;  width: size, height: size,  data: new Uint8Array(size * size * 4),  onAdd: function() &#123;    const canvas = document.createElement(&#x27;canvas&#x27;);    canvas.width = this.width;    canvas.height = this.height;    this.context = canvas.getContext(&#x27;2d&#x27;);  &#125;,  render: function() &#123;    const t = (performance.now() % 1000) / 1000;    const radius = size / 2 * 0.3;    const outerRadius = size / 2 * 0.7 * t + radius;    const ctx = this.context;    ctx.clearRect(0, 0, this.width, this.height);    // æ‰©æ•£æ³¢çº¹    ctx.beginPath();    ctx.arc(size/2, size/2, outerRadius, 0, Math.PI * 2);    ctx.fillStyle = `rgba(255, 200, 200, $&#123;1 - t&#125;)`;    ctx.fill();    // ä¸­å¿ƒåœ†ç‚¹    ctx.beginPath();    ctx.arc(size/2, size/2, radius, 0, Math.PI * 2);    ctx.fillStyle = &#x27;rgba(255, 100, 100, 1)&#x27;;    ctx.strokeStyle = &#x27;white&#x27;;    ctx.lineWidth = 2 + 2 * (1 - t);    ctx.fill();    ctx.stroke();    this.data = ctx.getImageData(0, 0, this.width, this.height).data;    map.triggerRepaint();    return true;  &#125;&#125;;\nè¿™ç§æ–¹å¼å¯ä»¥åŠ¨æ€æ¸²æŸ“æ¯ä¸€å¸§ï¼Œå¹¶è‡ªåŠ¨é€šçŸ¥ Mapbox é‡ç»˜ã€‚\nğŸŒ åŠ¨æ€èšç±»æ ·å¼ï¼ˆç‚¹æ•°è¶Šå¤šè¶Šå¤§&#x2F;è¶Šäº®ï¼‰é€šè¿‡ GeoJSON èšç±»åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ point_countï¼Œå†ä½¿ç”¨ step() è¡¨è¾¾å¼å®ç°æ ·å¼æ¸å˜ï¼š\npaint: &#123;  &#x27;circle-color&#x27;: [    &#x27;step&#x27;, [&#x27;get&#x27;, &#x27;point_count&#x27;],    &#x27;#51bbd6&#x27;, 10, &#x27;#f1f075&#x27;, 30, &#x27;#f28cb1&#x27;  ],  &#x27;circle-radius&#x27;: [    &#x27;step&#x27;, [&#x27;get&#x27;, &#x27;point_count&#x27;],    15, 10, 25, 30, 35  ]&#125;\n\nâš™ï¸ æ€§èƒ½ä¼˜åŒ–å»ºè®®é¿å…åœ°å›¾ä¸ŠåŒæ—¶ä½¿ç”¨å¤ªå¤š pulsingDot å®ä¾‹ï¼ˆæ¨è â‰¤ 100ï¼‰ï¼›\nèšç±»å›¾å±‚å†…éƒ¨è‡ªåŠ¨ç®¡ç†èšåˆç‚¹æ•°é‡ï¼Œå¯æ”¾å¿ƒç”¨äº 10K ä»¥ä¸Šæ•°æ®ï¼›\nè‹¥å›¾å±‚é—´æ•°æ®åŠ¨æ€æ›´æ–°é¢‘ç¹ï¼Œæ¨èåˆ†å›¾å±‚æ¸²æŸ“ã€å®šæ—¶æ›´æ–°ï¼›\nğŸ§  é€‚ç”¨åœºæ™¯å®æ—¶å®šä½ã€ç‰©è”ç½‘ç›‘æ§ã€è½¦æµåˆ†å¸ƒ\né›·è¾¾æ³¢ã€è„‰å†²æ‰«æåŠ¨ç”»æ¨¡æ‹Ÿ\né«˜å¹¶å‘æ•°æ®å±•ç¤ºåœºæ™¯ï¼ˆçƒ­åŠ›å›¾æ›¿ä»£æ–¹æ¡ˆï¼‰\nå®Œæ•´ä»£ç &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;meta charset=&quot;utf-8&quot;&gt;  &lt;title&gt;Mapbox GL åŠ¨ç”» MVP&lt;/title&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1,maximum-scale=1,user-scalable=no&quot;&gt;  &lt;link href=&quot;https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css&quot; rel=&quot;stylesheet&quot;&gt;  &lt;script src=&quot;https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js&quot;&gt;&lt;/script&gt;  &lt;style&gt;    body,html &#123; margin:0; padding:0; height:100% &#125;    #map &#123; position:absolute; top:0; bottom:0; width:100% &#125;  &lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;map&quot;&gt;&lt;/div&gt;&lt;script&gt;mapboxgl.accessToken = &#x27;YOUR_ACCESS_TOKEN&#x27;;const map = new mapboxgl.Map(&#123;  container: &#x27;map&#x27;, style: &#x27;mapbox://styles/mapbox/streets-v11&#x27;,  center: [116.397, 39.907], zoom: 10&#125;);// åŠ¨æ€é—ªçƒç‚¹ï¼špulsing dot å›¾æ ‡const size = 100;const pulsingDot = &#123;  width: size, height: size,  data: new Uint8Array(size * size * 4),  onAdd: function() &#123;    const canvas = document.createElement(&#x27;canvas&#x27;);    canvas.width = this.width; canvas.height = this.height;    this.context = canvas.getContext(&#x27;2d&#x27;);  &#125;,  render: function() &#123;    const t = (performance.now() % 1000) / 1000;    const radius = size / 2 * 0.3;    const outerRadius = size / 2 * 0.7 * t + radius;    const ctx = this.context;    ctx.clearRect(0, 0, this.width, this.height);    // å¤–åœˆæ³¢çº¹    ctx.beginPath();    ctx.arc(size/2, size/2, outerRadius, 0, Math.PI * 2);    ctx.fillStyle = `rgba(255, 200, 200, $&#123;1 - t&#125;)`;    ctx.fill();    // ä¸­å¿ƒé—ªçƒç‚¹    ctx.beginPath();    ctx.arc(size/2, size/2, radius, 0, Math.PI * 2);    ctx.fillStyle = &#x27;rgba(255, 100, 100, 1)&#x27;;    ctx.strokeStyle = &#x27;white&#x27;;    ctx.lineWidth = 2 + 2 * (1 - t);    ctx.fill();    ctx.stroke();    this.data = ctx.getImageData(0, 0, this.width, this.height).data;    // æ¯å¸§é‡ç»˜å›¾æ ‡    map.triggerRepaint();    return true;  &#125;&#125;;map.on(&#x27;load&#x27;, () =&gt; &#123;  map.addImage(&#x27;pulsing-dot&#x27;, pulsingDot, &#123; pixelRatio: 2 &#125;);  map.addSource(&#x27;dot-point&#x27;, &#123;    type: &#x27;geojson&#x27;,    data: &#123;      type: &#x27;FeatureCollection&#x27;,      features: [&#123;        type:&#x27;Feature&#x27;,        geometry: &#123; type:&#x27;Point&#x27;, coordinates:[116.397,39.907] &#125;      &#125;]    &#125;  &#125;);  map.addLayer(&#123;    id: &#x27;layer-with-pulsing-dot&#x27;,    type: &#x27;symbol&#x27;,    source: &#x27;dot-point&#x27;,    layout: &#123; &#x27;icon-image&#x27;: &#x27;pulsing-dot&#x27; &#125;  &#125;);  // ç¾¤é›†ç‚¹ç¤ºä¾‹ï¼šåŠ¨æ€èšç±»å¤§å°ä¸é¢œè‰²  map.addSource(&#x27;random-points&#x27;, &#123;    type: &#x27;geojson&#x27;,    data: generateRandomPoints(),    cluster: true,    clusterMaxZoom: 14,    clusterRadius: 50  &#125;);  map.addLayer(&#123;    id: &#x27;clusters&#x27;,    type: &#x27;circle&#x27;,    source: &#x27;random-points&#x27;,    filter: [&#x27;has&#x27;, &#x27;point_count&#x27;],    paint: &#123;      &#x27;circle-color&#x27;: [        &#x27;step&#x27;,[&#x27;get&#x27;,&#x27;point_count&#x27;], &#x27;#51bbd6&#x27;, 10, &#x27;#f1f075&#x27;, 30, &#x27;#f28cb1&#x27;      ],      &#x27;circle-radius&#x27;: [        &#x27;step&#x27;,[&#x27;get&#x27;,&#x27;point_count&#x27;], 15, 10, 25, 30, 35      ]    &#125;  &#125;);  map.addLayer(&#123;    id: &#x27;cluster-count&#x27;,    type: &#x27;symbol&#x27;,    source: &#x27;random-points&#x27;,    filter: [&#x27;has&#x27;, &#x27;point_count&#x27;],    layout: &#123; &#x27;text-field&#x27;: [&#x27;get&#x27;,&#x27;point_count&#x27;], &#x27;text-size&#x27;: 12 &#125;  &#125;);  map.addLayer(&#123;    id: &#x27;unclustered-point&#x27;,    type: &#x27;circle&#x27;,    source: &#x27;random-points&#x27;,    filter: [&#x27;!&#x27;, [&#x27;has&#x27;,&#x27;point_count&#x27;]],    paint: &#123;      &#x27;circle-color&#x27;: &#x27;#11b4da&#x27;,      &#x27;circle-radius&#x27;: 6,      &#x27;circle-stroke-width&#x27;: 1,      &#x27;circle-stroke-color&#x27;: &#x27;#fff&#x27;    &#125;  &#125;);&#125;);// éšæœºç”Ÿæˆè‹¥å¹²ä¸ªç‚¹function generateRandomPoints() &#123;  const features = [];  for (let i = 0; i &lt; 2000; i++) &#123;    const lon = 116.2 + (Math.random() * 0.4);    const lat = 39.8 + (Math.random() * 0.4);    features.push(&#123;      type:&#x27;Feature&#x27;, geometry:&#123;type:&#x27;Point&#x27;, coordinates:[lon,lat]&#125;    &#125;);  &#125;  return &#123; type:&#x27;FeatureCollection&#x27;, features &#125;;&#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;","tags":["mapboxgl"]},{"title":"tsæ‰‹å†™å·¥å…·å‡½æ•°","url":"/2025/08/06/ts%E6%89%8B%E5%86%99%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/","content":"é˜²æŠ–export function debounce&lt;T extends (...args: any[]) =&gt; void&gt;(  fn: T,  delay: number): (...args: Parameters&lt;T&gt;) =&gt; void &#123;  let timer: ReturnType&lt;typeof setTimeout&gt; | null = null;  return function (...args: Parameters&lt;T&gt;) &#123;    if (timer) clearTimeout(timer);    timer = setTimeout(() =&gt; &#123;      fn(...args);    &#125;, delay);  &#125;;&#125;\n\nèŠ‚æµexport function throttle&lt;T extends (...args: any[]) =&gt; void&gt;(  fn: T,  wait: number): (...args: Parameters&lt;T&gt;) =&gt; void &#123;  let lastTime = 0;  return function (...args: Parameters&lt;T&gt;) &#123;    const now = Date.now();    if (now - lastTime &gt;= wait) &#123;      lastTime = now;      fn(...args);    &#125;  &#125;;&#125;\n\næ·±æ‹·è´ deepCloneexport function deepClone&lt;T&gt;(target: T, map = new WeakMap()): T &#123;  // åŸºç¡€ç±»å‹æˆ–å‡½æ•°ç›´æ¥è¿”å›  if (typeof target !== &#x27;object&#x27; || target === null) return target;  // å·²å¤„ç†è¿‡çš„å¯¹è±¡ï¼Œç›´æ¥è¿”å›ä»¥é˜²å¾ªç¯å¼•ç”¨  if (map.has(target)) return map.get(target);  let clone: any;  const Constructor = (target as any).constructor;  switch (Constructor) &#123;    case Date:      clone = new Date((target as unknown as Date).getTime());      break;    case RegExp:      clone = new RegExp((target as unknown as RegExp).source, (target as unknown as RegExp).flags);      break;    case Map:      clone = new Map();      map.set(target, clone);      (target as unknown as Map&lt;any, any&gt;).forEach((value, key) =&gt; &#123;        clone.set(deepClone(key, map), deepClone(value, map));      &#125;);      return clone;    case Set:      clone = new Set();      map.set(target, clone);      (target as unknown as Set&lt;any&gt;).forEach((value) =&gt; &#123;        clone.add(deepClone(value, map));      &#125;);      return clone;    default:      clone = Array.isArray(target) ? [] : &#123;&#125;;      map.set(target, clone);      for (const key in target) &#123;        if (Object.prototype.hasOwnProperty.call(target, key)) &#123;          clone[key] = deepClone((target as any)[key], map);        &#125;      &#125;      return clone;  &#125;  map.set(target, clone);  return clone;&#125;","tags":["typescript"]},{"title":"TypeScript å®ç°é€šç”¨å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆæ”¯æŒç±»å‹æ¨å¯¼ï¼‰","url":"/2025/07/25/%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/","content":"æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒæŒ‡çš„æ˜¯å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—æ¥æ”¶å•ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨åªå¤„ç†ä¸€ä¸ªå‚æ•°ï¼Œç›´åˆ°æ¥æ”¶å®Œæ‰€æœ‰å‚æ•°å¹¶æ‰§è¡Œå‡½æ•°ã€‚\nåœ¨ javascript ä¸­ï¼Œlodash ç­‰å‡½æ•°å·¥å…·åº“æä¾›äº† _.curry æ–¹æ³•ã€‚ä½†ä»Šå¤©æˆ‘ä»¬ä¸ä½¿ç”¨åº“ï¼Œè€Œæ˜¯ç”¨ TypeScript å®ç°ä¸€ä¸ªå…·å¤‡å®Œæ•´ç±»å‹æ¨å¯¼çš„é€šç”¨ curry å‡½æ•°ã€‚\n\n.mermaid {\n  display: flex;\n  justify-content: center;\n  margin: 2em 0;\n}\n\n\ngraph TD\n  A[åŸå§‹å‡½æ•°] --> B[å‡½æ•°å®šä¹‰]\n  A --> C[å‚æ•°ä¼ é€’æµç¨‹]\n  B --> D[\"function f(a: A, b: B, c: C)\"]\n  C --> E[\"a: A\"]\n  C --> F[\"(b: B)\"]\n  C --> G[\"(c: C)\"]\n\n\n\nğŸ” ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š\nfunction a(age: number, name: string, gender: 0 | 1) &#123;  return `$&#123;name&#125; is $&#123;age&#125; years old, gender: $&#123;gender === 0 ? &#x27;Female&#x27; : &#x27;Male&#x27;&#125;`;&#125;````æˆ‘ä»¬å¸Œæœ›å¯ä»¥è¿™æ ·è°ƒç”¨å®ƒï¼š```tsconst curried = curry(a);const step1 = curried(23);         // æ¨å¯¼ä¸º (name: string) =&gt; ...const step2 = step1(&#x27;Alice&#x27;);      // æ¨å¯¼ä¸º (gender: 0 | 1) =&gt; ...const result = step2(0);           // æœ€ç»ˆ result æ˜¯ string ç±»å‹\n\n\nâœ… æœ€ç»ˆå®ç°è¿™æ®µä»£ç çš„å…³é”®æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\nç±»å‹å®šä¹‰ï¼šæˆ‘ä»¬è¦è®© TypeScript èƒ½å¤Ÿè‡ªåŠ¨æ¨å¯¼æ¯ä¸€å±‚å‚æ•°çš„ç±»å‹ï¼›\nè¿è¡Œæ—¶é€»è¾‘ï¼šè¦åœ¨æ¯æ¬¡è°ƒç”¨æ—¶åˆ¤æ–­å‚æ•°æ˜¯å¦æ”¶é›†å®Œï¼Œè‹¥æœªå®Œæˆï¼Œåˆ™è¿”å›ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n// ç±»å‹å®šä¹‰type Curried&lt;A extends any[], R&gt; =   A extends [] ? () =&gt; R :  A extends [infer F] ? (x: F) =&gt; R :  A extends [infer F, ...infer Rest] ? (x: F) =&gt; Curried&lt;Rest, R&gt; :  never;// å‡½æ•°å®ç°function curry&lt;A extends any[], R&gt;(fn: (...args: A) =&gt; R): Curried&lt;A, R&gt; &#123;  return function curried(...args: any[]): any &#123;    if (args.length &gt;= fn.length) &#123;      return fn(...args as A);    &#125; else &#123;      return (...next: any[]) =&gt; curried(...args, ...next);    &#125;  &#125; as Curried&lt;A, R&gt;;&#125;\n\n\næ³¨æ„ï¼šas Curried&lt;A, R&gt; æ˜¯å…³é”®çš„ä¸€æ­¥ç±»å‹æ–­è¨€ï¼Œç”¨äºè®©æœ€ç»ˆè¿”å›å€¼æ‹¥æœ‰æ­£ç¡®çš„ç±»å‹æç¤ºã€‚\n\n\nğŸ§  ç±»å‹æ¨å¯¼åŸç†è§£ææˆ‘ä»¬æ¥çœ‹ Curried çš„ç±»å‹å®šä¹‰ï¼š\ntype Curried&lt;A extends any[], R&gt; =   A extends [] ? () =&gt; R :  A extends [infer F] ? (x: F) =&gt; R :  A extends [infer F, ...infer Rest] ? (x: F) =&gt; Curried&lt;Rest, R&gt; :  never;\n\n\nA æ˜¯ä¸€ä¸ªå‚æ•°æ•°ç»„ç±»å‹ï¼Œä¾‹å¦‚ [number, string, boolean]ã€‚\nå¦‚æœæ˜¯ç©ºæ•°ç»„ï¼Œè¿”å› () =&gt; Rã€‚\nå¦‚æœæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè¿”å› (x: å‚æ•°ç±»å‹) =&gt; Rã€‚\nå¦åˆ™é€’å½’è¿”å› (x: ç¬¬ä¸€ä¸ªå‚æ•°) =&gt; æŸ¯é‡ŒåŒ–å‰©ä¸‹çš„å‚æ•°ã€‚\n\nè¿™å°±å®ç°äº†ç±»å‹å±‚é¢ä¸Šçš„â€œå‚æ•°åˆ†å‘â€ã€‚\n\nğŸš€ ä½¿ç”¨ç¤ºä¾‹æˆ‘ä»¬å†å›å¤´çœ‹çœ‹æœ€åˆçš„ç¤ºä¾‹ï¼Œçœ‹çœ‹ TypeScript èƒ½å¦æ­£ç¡®æ¨å¯¼ç±»å‹ï¼š\nfunction a(age: number, name: string, gender: 0 | 1) &#123;  return `$&#123;name&#125; is $&#123;age&#125; years old, gender: $&#123;gender === 0 ? &#x27;Female&#x27; : &#x27;Male&#x27;&#125;`;&#125;const curried = curry(a);const fn1 = curried(18);         // æ¨å¯¼ä¸º (name: string) =&gt; ...const fn2 = fn1(&#x27;Bob&#x27;);          // æ¨å¯¼ä¸º (gender: 0 | 1) =&gt; ...const result = fn2(1);           // æ¨å¯¼ä¸º stringconsole.log(result); // &quot;Bob is 18 years old, gender: Male&quot;\n\nTypeScript å…¨ç¨‹éƒ½èƒ½æ­£ç¡®æç¤ºå‚æ•°ç±»å‹ âœ…ã€‚\n\nğŸ§© è¡¥å……æ€è€ƒï¼šæŸ¯é‡ŒåŒ–çš„æ„ä¹‰ï¼ŸæŸ¯é‡ŒåŒ–çš„ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯å‚æ•°å¤ç”¨å’Œå‡½æ•°ç»„åˆï¼š\nconst withAge18 = curried(18);const withAge18AndNameTom = withAge18(&#x27;Tom&#x27;);console.log(withAge18AndNameTom(0)); // &quot;Tom is 18 years old, gender: Female&quot;\n\nè¿™ç§â€œé¢„è®¾éƒ¨åˆ†å‚æ•°â€çš„æ–¹å¼ï¼Œåœ¨è¡¨å•å¤„ç†ã€é…ç½®å‡½æ•°ã€äº‹ä»¶ç»‘å®šç­‰åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚\n\nğŸ§± æ€»ç»“\næˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ”¯æŒå®Œæ•´ç±»å‹æ¨å¯¼çš„ curry å‡½æ•°ï¼›\nåˆ©ç”¨äº† TypeScript çš„æ¡ä»¶ç±»å‹ã€é€’å½’ç±»å‹ç­‰é«˜çº§æŠ€å·§ï¼›\nåœ¨å¤šä¸ªå‚æ•°çš„å‡½æ•°ä¸­ï¼Œä¹Ÿèƒ½é€å±‚ä¼ å‚å¹¶å¾—åˆ°è‰¯å¥½çš„ç±»å‹æç¤ºï¼›\næŸ¯é‡ŒåŒ–æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å®é™…å¼€å‘ä¸­ä¹Ÿæœ‰ä¸å°‘è½åœ°åœºæ™¯ã€‚\n\nå¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œä¸å¦¨ç‚¹èµ + æ”¶è—ï¼Œä¸€èµ·æ¢ç´¢æ›´å¤š TypeScript é­”æ³• âœ¨\n","tags":["typescript","å‡½æ•°å¼ç¼–ç¨‹","æŸ¯é‡ŒåŒ–","é«˜é˜¶å‡½æ•°"]},{"title":"åå˜ä¸é€†å˜","url":"/2025/07/26/%E5%8D%8F%E5%8F%98%E4%B8%8E%E9%80%86%E5%8F%98/","content":"åå˜ï¼ˆCovarianceï¼‰ç®€å•è¯´ï¼Œåå˜è¡¨ç¤ºç±»å‹åœ¨æŸä¸ªæ–¹å‘ä¸Šä¿æŒâ€œè¶Šå…·ä½“è¶Šå¥½â€çš„å…¼å®¹æ€§ã€‚\nåœ¨ TypeScript ä¸­ï¼Œè¿”å›å€¼ç±»å‹æ˜¯åå˜çš„ï¼š\ntype Animal = &#123; name: string &#125;type Dog = &#123; name: string; bark: () =&gt; void &#125;let getAnimal: () =&gt; Animallet getDog: () =&gt; DoggetAnimal = getDog // âœ… åˆæ³•getDog = getAnimal // âŒ æŠ¥é”™\n\nè§£é‡Šä¸€ä¸‹ï¼š\n\ngetDog è¿”å›çš„æ˜¯æ›´å…·ä½“çš„ç±»å‹ï¼ˆDogï¼‰ï¼Œèµ‹å€¼ç»™è¿”å›ç±»å‹æ˜¯ Animal çš„ getAnimal æ˜¯æ²¡é—®é¢˜çš„ï¼›\nåè¿‡æ¥åˆ™ä¸è¡Œï¼Œå› ä¸º getAnimal å¯èƒ½è¿”å›ä¸€åªçŒ«ï¼Œä½ ä¸èƒ½å‡è®¾å®ƒä¸€å®šä¼š bark()ã€‚\n\nè¿™å°±æ˜¯åå˜ï¼šè¿”å›å€¼å¯ä»¥æ›´å…·ä½“ï¼Œä½†ä¸èƒ½æ›´æ³›åŒ–ã€‚\né€†å˜ï¼ˆContravarianceï¼‰é€†å˜æ˜¯å‚æ•°ç±»å‹çš„è¡Œä¸ºï¼Œå’Œåå˜æ­£å¥½ç›¸åï¼šè¶Šæ³›åŒ–è¶Šå®‰å…¨ã€‚\ntype Animal = &#123; name: string &#125;type Dog = &#123; name: string; bark: () =&gt; void &#125;let handleAnimal: (a: Animal) =&gt; voidlet handleDog: (d: Dog) =&gt; voidhandleDog = handleAnimal // âœ… åˆæ³•handleAnimal = handleDog // âŒ æŠ¥é”™\n\nè§£é‡Šï¼š\n\nhandleAnimal èƒ½å¤„ç†æ‰€æœ‰åŠ¨ç‰©ï¼Œå½“ç„¶ä¹Ÿèƒ½å¤„ç†ç‹—ã€‚\nä½† handleDog åªä¼šå¤„ç†ä¼šå«çš„ç‹—ï¼Œä¸‡ä¸€ä½ ä¼ è¿›å»ä¸€åªçŒ«ï¼Œå®ƒä¸ä¼š bark() å°±ç‚¸äº†ã€‚\n\nè¿™å°±æ˜¯é€†å˜ï¼šå‚æ•°ç±»å‹è¶Šå®½æ³›ï¼Œè¶Šä¿é™©ã€‚\nTips\nå¦‚æœå®åœ¨è®°ä¸ä½ï¼Œå°±è¿™ä¹ˆè®°ï¼šè¿”å›å€¼åå˜ï¼Œå‚æ•°é€†å˜\nTypeScript å®é™…ä¸Šåœ¨å‡½æ•°å‚æ•°çš„é€†å˜åˆ¤æ–­ä¸Šæœ‰ç‚¹â€œå®½æ¾â€ï¼ˆé»˜è®¤æ˜¯åŒå‘åå˜ï¼‰ï¼Œä½†å¼€å¯ strictFunctionTypes åæ‰æ˜¯â€œæ ‡å‡†æ¨¡å¼â€\nArray&lt;T&gt; æ˜¯åå˜çš„ï¼ˆå› ä¸ºåªè¯»ï¼‰ï¼Œä½† T[] æ˜¯ä¸å®Œå…¨åå˜çš„ï¼ˆå› ä¸ºå¯ä»¥å†™ï¼‰\n\næœ€åææ‡‚åå˜&#x2F;é€†å˜ï¼Œæœ¬è´¨æ˜¯åœ¨ç†è§£â€œç±»å‹çš„æ›¿æ¢æ˜¯å¦å®‰å…¨â€è¿™ä¸ªäº‹ã€‚ä¸æ˜¯æ™¦æ¶©çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç±»å‹ç³»ç»ŸèƒŒåçš„å®‰å…¨ä¿éšœã€‚\nå¦‚æœä½ ç»å¸¸å†™æ³›å‹å‡½æ•°ã€å°è£…åº“ã€æˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å¤æ‚ç±»å‹æ¨å¯¼ï¼Œç†è§£å®ƒä»¬ä¼šè®©ä½ æ›´æ”¾å¿ƒåœ°â€œæ”¾ç±»å‹é£â€ã€‚\n","tags":["typescript"]},{"title":"ç”¨tsæ„å»ºé•¿å±æ€§åˆ—è¡¨","url":"/2025/07/09/%E7%94%A8ts%E6%9E%84%E5%BB%BA%E9%95%BF%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8/","content":"è§£å†³æ–¹æ¡ˆtype Fields&lt;Count = 0, Props extends string[] = []&gt; = Props[&#x27;length&#x27;] extends Count ? Props[number]: Fields&lt;Count, [...Props, `ad_$&#123;Props[&#x27;length&#x27;]&#125;`]&gt;;type SensorInfo  =&#123;  [K in Fields&lt;31&gt;]: number;&#125;\n","tags":["typescript","å‰ç«¯"]},{"title":"è§£ætiff","url":"/2025/07/16/%E8%A7%A3%E6%9E%90tiff/","content":"æ ¸å¿ƒåŸç†å’Œæµç¨‹è¯»å–æ–‡ä»¶ç¼“å†²åŒºconst buffer = fs.readFileSync(filePath);const tiff = await GeoTIFF.fromArrayBuffer(buffer.buffer);const image = await tiff.getImage();\n\n\nç”¨ fs.readFileSync åŒæ­¥è¯»å–æ•´ä¸ª .tif/.tiff äºŒè¿›åˆ¶å†…å®¹åˆ°å†…å­˜ã€‚\nGeoTIFF.fromArrayBuffer å°†è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®è§£ææˆä¸€ä¸ª TIFF å¯¹è±¡ï¼Œå†…éƒ¨ä¼šè¯»å– TIFF å¤´ã€IFDï¼ˆå›¾åƒæ–‡ä»¶ç›®å½•ï¼‰ç­‰ç»“æ„ã€‚\ngetImage() æ‹¿åˆ°ç¬¬ä¸€ä¸ªå½±åƒå¸§ï¼ˆTIFF å¯ä»¥åŒ…å«å¤šå¸§ï¼Œä½†æˆ‘ä»¬é€šå¸¸åªå…³å¿ƒç¬¬ä¸€ä¸ªå›¾å±‚ï¼‰ã€‚\n\nè·å–æ …æ ¼å°ºå¯¸const width = image.getWidth();const height = image.getHeight();\n\n\nç›´æ¥ä» TIFF å…ƒæ•°æ®é‡Œè¯»å‡ºæ …æ ¼å®½é«˜ï¼Œç”¨äºåç»­çš„åƒç´ éå†å’Œç”»å¸ƒåˆ›å»ºã€‚\n\nè§£æåœ°ç†å‚è€ƒä¿¡æ¯ï¼ˆTiePoints + PixelScaleï¼‰const tiePoints = image.getTiePoints();const scale = image.getFileDirectory().ModelPixelScale;const originX = tiePoints[0].x;const originY = tiePoints[0].y;const [pixelSizeX, pixelSizeY] = scale;\n\n\nTiePointsï¼šä¸€å¯¹æˆ–å¤šå¯¹åƒç´ åæ ‡ â†” åœ°ç†åæ ‡ï¼ˆé€šå¸¸åªæœ‰ä¸€å¯¹ï¼‰ï¼Œå‘Šè¯‰æˆ‘ä»¬å½±åƒå·¦ä¸Šè§’ï¼ˆæˆ–æŸä¸ªåƒç´ ï¼‰çš„åœ°å›¾æŠ•å½±åæ ‡ã€‚\nModelPixelScaleï¼šæ¯ä¸ªåƒç´ åœ¨æŠ•å½±åæ ‡ç³»ä¸‹çš„çœŸå®é•¿åº¦ï¼ˆXã€Y æ–¹å‘ï¼‰ã€‚\nç”±æ­¤ï¼Œå°±èƒ½ç®—å‡ºæ•´å¼ å½±åƒåœ¨æŠ•å½±åæ ‡ç³»ä¸‹çš„è¾¹ç•Œï¼š- å·¦ä¸‹è§’ (minX, minY)- å³ä¸Šè§’ (maxX, maxY)\n\nè¯»å–æŠ•å½±ï¼ˆEPSGï¼‰ä¿¡æ¯const geoKeys = image.getGeoKeys();const epsgCode = geoKeys.ProjectedCSTypeGeoKey || geoKeys.GeographicTypeGeoKey;const sourceCrs = `EPSG:$&#123;epsgCode&#125;`;\n\n\nGeoKeys ä¸­å­˜ç€ TIFF é‡Œè®°å½•çš„æŠ•å½±ä»£ç ï¼Œæ¯”å¦‚ 3857ã€4326 ç­‰ã€‚\næ‹¼æˆ EPSG:XXXX å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿åç»­ç”¨ proj4 åšåæ ‡è½¬æ¢ã€‚\n\næŠ•å½±åæ ‡ â†’ åœ°ç†åæ ‡ï¼ˆç»çº¬åº¦ï¼‰const transformer = proj4(sourceCrs, &quot;EPSG:4326&quot;);const [minLon, minLat] = transformer.forward([minX, minY]);const [maxLon, maxLat] = transformer.forward([maxX, maxY]);\n\n\nç”¨ proj4 åœ¨ä¸åŒ CRSï¼ˆå¦‚ WebMercatorã€UTMï¼‰ä¹‹é—´æ— ç¼æŠ•å½±è½¬æ¢ã€‚\nå°†å››ä¸ªè§’çš„æŠ•å½±åæ ‡è½¬æ¢åˆ° WGS84ï¼ˆEPSG:4326ï¼‰ä¸‹çš„ç»çº¬åº¦ã€‚\n\nè¯»å–åƒç´ æ …æ ¼å¹¶å‡†å¤‡æ¸²æŸ“const rasters = await image.readRasters(&#123; interleave: true &#125;);const rasterData = rasters instanceof Uint8ClampedArray  ? rasters  : new Uint8ClampedArray(rasters as unknown as Uint8Array);\n\n\nreadRasters(&#123; interleave: true &#125;) ä¼šä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰æ³¢æ®µæ•°æ®å¹¶æŒ‰ RGBAã€ç°åº¦ç­‰æ ¼å¼æ’åˆ—ã€‚\nCanvas çš„ ImageData è¦æ±‚åº•å±‚æ•°æ®æ˜¯ Uint8ClampedArrayï¼Œæ‰€ä»¥è¿™é‡Œåšäº†ç±»å‹å…¼å®¹è½¬æ¢ã€‚\n\nåœ¨ Canvas ä¸Šç»˜åˆ¶æ …æ ¼const canvas = createCanvas(width, height);const ctx = canvas.getContext(&quot;2d&quot;);const imgData = ctx.createImageData(width, height);imgData.data.set(rasterData);ctx.putImageData(imgData, 0, 0);\n\n\ncreateCanvas æ ¹æ®å½±åƒå°ºå¯¸æ–°å»ºå†…å­˜ç”»å¸ƒã€‚\nç”¨ createImageData æ–°å»ºä¸€ä¸ªç©ºç™½çš„åƒç´ ç¼“å†²åŒºï¼Œdata.set(...) å°†æ …æ ¼æ•°æ®å†™å…¥ï¼Œå†ä¸€å£æ°”ç»˜åˆ¶åˆ°ç”»å¸ƒã€‚\n\nå¯¼å‡ºä¸ºå›¾ç‰‡æ–‡ä»¶const outPath = filePath.replace(/\\.(tif|tiff)$/i, &quot;.png&quot;);fs.writeFileSync(outPath, canvas.toBuffer(&quot;image/png&quot;));fs.writeFileSync(outPath, webpBuffer);\n\n\ncanvas.toBuffer(&#39;image/png&#39;) ä¼šè°ƒç”¨åº•å±‚çš„å›¾åƒåº“ï¼ˆå¦‚ libvips æˆ– Cairoï¼‰å°†ç”»å¸ƒå†…å®¹ç¼–ç ä¸º PNG æ ¼å¼ã€‚\næœ€åå†™ç£ç›˜ç”Ÿæˆ .png æ–‡ä»¶ã€‚\n\nè¿”å›ç»¼åˆå…ƒä¿¡æ¯return &#123;  width,  height,  sourceCrs,  bboxSource: &#123; minX, minY, maxX, maxY &#125;,  bboxLatLng: &#123; minLat, minLon, maxLat, maxLon &#125;,  geoKeys,  webp: outPath,&#125;;\n\n\nå°†æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼ˆåŸå§‹æŠ•å½±åæ ‡è¾¹ç•Œã€åœ°ç†åæ ‡è¾¹ç•Œã€è¾“å‡ºæ–‡ä»¶è·¯å¾„ç­‰ï¼‰æ‰“åŒ…è¿”å›ï¼Œæ–¹ä¾¿åç»­è‡ªåŠ¨åŒ–æµæ°´çº¿ä½¿ç”¨æˆ–è®°å½•ã€‚\n\n\næ ¸å¿ƒæ€è·¯ï¼š\nè§£æ TIFF å…ƒæ•°æ® è·å–æŠ•å½±ã€åœ°ç†å®šä½ä¿¡æ¯ï¼ˆTiePoints + Scale + GeoKeysï¼‰ï¼›\nè½¬æ¢åæ ‡ å¾—åˆ°äººç±»æ˜“è¯»çš„ç»çº¬åº¦ï¼›\nè¯»å–å¹¶å¯è§†åŒ–å½±åƒ æ„å»º Canvasï¼Œæ¸²æŸ“æˆæ ‡å‡†å›¾åƒæ ¼å¼ï¼›\nè¾“å‡ºæ–‡ä»¶å’Œå…ƒæ•°æ® ä¾›åç»­ä½¿ç”¨ã€‚\n\nè¿™æ ·ï¼Œä½ å°±èƒ½åœ¨çº¯ Node.js ç¯å¢ƒä¸‹ï¼Œå®ç°å¯¹ä»»ä½• GeoTIFF æ–‡ä»¶çš„â€œè¯»æŠ•å½±ã€ç®—èŒƒå›´ã€å‡ºå›¾ç‰‡â€è¿™ä¸€æ•´å¥—æµç¨‹ã€‚\n\nå®Œæ•´ä»£ç /* * Node.js script to read a GeoTIFF (.tif/.tiff), extract its projection, * compute geographic bounding box, and render the raster to a PNG image. * * Dependencies: *   npm install geotiff proj4 canvas */import fs from &#x27;fs&#x27;;import * as GeoTIFF from &#x27;geotiff&#x27;;import proj4 from &#x27;proj4&#x27;;import &#123; createCanvas &#125; from &#x27;canvas&#x27;;async function parseGeoTIFF(filePath: string) &#123;  // 1. Read file into buffer  const buffer = fs.readFileSync(filePath);  // 2. Parse the GeoTIFF  const tiff = await GeoTIFF.fromArrayBuffer(buffer.buffer);  const image = await tiff.getImage();  // 3. Image dimensions  const width = image.getWidth();  const height = image.getHeight();  // 4. Geo tie points &amp; pixel scale  const tiePoints = image.getTiePoints();  const scale = image.getFileDirectory().ModelPixelScale;  if (!tiePoints.length || !scale) &#123;    throw new Error(&#x27;Missing geo-referencing tags (tie points or pixel scale)&#x27;);  &#125;  const &#123; x: originX, y: originY &#125; = tiePoints[0];  const [pixelSizeX, pixelSizeY] = scale;  // 5. Compute bounding box in source CRS  const minX = originX;  const maxY = originY;  const maxX = originX + width * pixelSizeX;  const minY = originY - height * pixelSizeY;  // 6. Projection info (EPSG code)  const geoKeys = image.getGeoKeys();  const epsgCode = geoKeys.ProjectedCSTypeGeoKey || geoKeys.GeographicTypeGeoKey;  const sourceCrs = EPSG:$&#123;epsgCode&#125;;  // 7. Transform corners to WGS84 (lat/lon)  const transformer = proj4(sourceCrs, &#x27;EPSG:4326&#x27;);  const [minLon, minLat] = transformer.forward([minX, minY]);  const [maxLon, maxLat] = transformer.forward([maxX, maxY]);  // 8. Read raster data (interleaved)  const rastersRaw = await image.readRasters(&#123; interleave: true &#125;);  // Convert to Uint8ClampedArray for ImageData  const rasterData =    rastersRaw instanceof Uint8ClampedArray      ? rastersRaw      : new Uint8ClampedArray(rastersRaw as any);  // 9. Render to canvas  const canvas = createCanvas(width, height);  const ctx = canvas.getContext(&#x27;2d&#x27;);  const imgData = ctx.createImageData(width, height);  imgData.data.set(rasterData);  ctx.putImageData(imgData, 0, 0);  // 10. Save PNG  const outPath = filePath.replace(/\\.(tif|tiff)$/i, &#x27;.png&#x27;);  fs.writeFileSync(outPath, canvas.toBuffer(&#x27;image/png&#x27;));  // 11. Return metadata  return &#123;    width,    height,    sourceCrs,    bboxSource: &#123; minX, minY, maxX, maxY &#125;,    bboxLatLng: &#123; minLat, minLon, maxLat, maxLon &#125;,    geoKeys,    png: outPath  &#125;;&#125;// Example usage:(async () =&gt; &#123;  try &#123;    const result = await parseGeoTIFF(process.argv[2]);    console.log(&#x27;Parsed GeoTIFF metadata:&#x27;);    console.log(JSON.stringify(result, null, 2));  &#125; catch (err) &#123;    console.error(&#x27;Error parsing GeoTIFF:&#x27;, err);  &#125;&#125;)();\n","tags":["GIS","tiff"]}]