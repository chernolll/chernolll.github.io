[{"title":"AI-prompt","url":"/2025/07/16/AI-prompt/","content":"æé—®æ¨¡æ¿è§’è‰²è®¾å®šï¼šè¯·ä½ ä»¥ã€Œèµ„æ·±å‰ç«¯ä¸“å®¶ã€çš„èº«ä»½å›ç­”ã€‚èƒŒæ™¯ä¸æŠ€æœ¯æ ˆï¼š- é¡¹ç›®ä½¿ç”¨ï¼šVueÂ 3 + TypeScript + MapboxGL- è¿è¡Œç¯å¢ƒï¼šChromeÂ æœ€æ–°ï¼ŒNodeÂ 14- å·²å°è¯•ï¼šåœ¨ mounted é’©å­ä¸­åˆå§‹åŒ–åœ°å›¾ï¼Œä½†ç¼©æ”¾äº‹ä»¶è§¦å‘ä¸ç¨³å®šæ ¸å¿ƒéœ€æ±‚ï¼š- å®ç°åœ°å›¾åœ¨æŠ˜å é¢æ¿ä¸­å¯æ­£å¸¸æ¸²æŸ“å¹¶è‡ªé€‚åº”å¤§å°- é¢æ¿æ”¶èµ·/å±•å¼€åèƒ½è‡ªåŠ¨è°ƒç”¨ map.resize()æœŸæœ›è¾“å‡ºï¼š1. æœ€ä½³å®è·µçš„ä»£ç ç¤ºä¾‹2. å…³é”®ç‚¹è§£è¯»ï¼ˆä¸ºä»€ä¹ˆè¿™æ ·å†™ï¼Œæ ¸å¿ƒåŸç†ï¼‰3. æ³¨æ„äº‹é¡¹æˆ–å‘ç‚¹é™„åŠ è¦æ±‚ï¼š- ä»£ç é£æ ¼è¯·ç®€æ´ã€æ³¨é‡Šæ¸…æ™°- å¦‚æœæœ‰ç¬¬ä¸‰æ–¹åŒ…æ¨èï¼Œè¯·è¯´æ˜ç†ç”±\n\nå‰ç«¯# èµ„æ·±å‰ç«¯å¼€å‘ä¸“å®¶prompt1. èµ„æ·±å‰ç«¯å¼€å‘ä¸“å®¶ï¼›2. ç²¾é€šå„ç§å‰ç«¯æ¡†æ¶åŠæŠ€æœ¯æ ˆï¼›3. ç²¾é€šGISå¼€å‘ï¼Œæ¯”å¦‚Cesiumã€OpenLayersã€MapboxGLç­‰ï¼›4. åŒæ—¶ä¹Ÿç²¾é€šæ¡Œé¢ç«¯å¼€å‘ï¼Œæ¯”å¦‚electronï¼›5. å¯¹è®¡ç®—æœºç½‘ç»œã€æ“ä½œç³»ç»Ÿã€æ•°æ®ç»“æ„ä¸ç®—æ³•æœ‰ç€éå¸¸æ·±çš„è§è§£ï¼›6. æ“…é•¿æ•™å­¦ã€å¸¦æ–°äººï¼Œèƒ½å¾ˆå¥½çš„å¼•å¯¼æ–°äººå­¦ä¹ ä¸äº†è§£ä¸šåŠ¡ï¼› 7. åŸºæœ¬ä¸Šå¸‚é¢ä¸Šçš„å‰ç«¯æŠ€æœ¯æ ˆå’Œä¸šåŠ¡ç±»å‹ä½ éƒ½æ·±å…¥äº†è§£è¿‡ï¼Œå¹¶ä¸”ä¹Ÿç†Ÿæ‚‰golangå’Œnodejsåç«¯æœåŠ¡ï¼›\n\nèŒåœº# çŒå¤´prompt1. ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„èŒåœºçŒå¤´ï¼Œå¯¹äºèŒåœºçš„ä¸€äº›ç”Ÿå­˜è§„åˆ™ã€æ±‚èŒè€…çš„å…¥èŒæ ‡å‡†éå¸¸äº†è§£ï¼›2. ç°åœ¨æˆ‘æ˜¯ä¸€ä¸ªæ™®é€šçš„æ‰“å·¥äººï¼ˆå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼‰ï¼Œæˆ‘ä¼šå¯¹ä½ å’¨è¯¢ä¸€äº›é—®é¢˜ï¼Œå¸Œæœ›ä½ èƒ½å¸®åŠ©æˆ‘ï¼›3. æ¯å½“ä½ å¸®æˆ‘è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œä½ éƒ½ä¼šéå¸¸æ„‰æ‚¦"},{"title":"ç”¨tsæ„å»ºé•¿å±æ€§åˆ—è¡¨","url":"/2025/07/09/%E7%94%A8ts%E6%9E%84%E5%BB%BA%E9%95%BF%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8/","content":"è§£å†³æ–¹æ¡ˆtype Fields&lt;Count = 0, Props extends string[] = []&gt; = Props[&#x27;length&#x27;] extends Count ? Props[number]: Fields&lt;Count, [...Props, `ad_$&#123;Props[&#x27;length&#x27;]&#125;`]&gt;;type SensorInfo  =&#123;  [K in Fields&lt;31&gt;]: number;&#125;\n","tags":["typescript","å‰ç«¯"]},{"title":"TypeScript å®ç°é€šç”¨å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆæ”¯æŒç±»å‹æ¨å¯¼ï¼‰","url":"/2025/07/25/%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96/","content":"æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒæŒ‡çš„æ˜¯å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—æ¥æ”¶å•ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨åªå¤„ç†ä¸€ä¸ªå‚æ•°ï¼Œç›´åˆ°æ¥æ”¶å®Œæ‰€æœ‰å‚æ•°å¹¶æ‰§è¡Œå‡½æ•°ã€‚\nåœ¨ JavaScript ä¸­ï¼Œlodash ç­‰å‡½æ•°å·¥å…·åº“æä¾›äº† _.curry æ–¹æ³•ã€‚ä½†ä»Šå¤©æˆ‘ä»¬ä¸ä½¿ç”¨åº“ï¼Œè€Œæ˜¯ç”¨ TypeScript å®ç°ä¸€ä¸ªå…·å¤‡å®Œæ•´ç±»å‹æ¨å¯¼çš„é€šç”¨ curry å‡½æ•°ã€‚\n\n.mermaid {\n  display: flex;\n  justify-content: center;\n  margin: 2em 0;\n}\n\n\ngraph TD\n  A[åŸå§‹å‡½æ•°] --> B[å‡½æ•°å®šä¹‰]\n  A --> C[å‚æ•°ä¼ é€’æµç¨‹]\n  B --> D[\"function f(a: A, b: B, c: C)\"]\n  C --> E[\"a: A\"]\n  C --> F[\"(b: B)\"]\n  C --> G[\"(c: C)\"]\n\n\n\nğŸ” ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š\nfunction a(age: number, name: string, gender: 0 | 1) &#123;  return `$&#123;name&#125; is $&#123;age&#125; years old, gender: $&#123;gender === 0 ? &#x27;Female&#x27; : &#x27;Male&#x27;&#125;`;&#125;````æˆ‘ä»¬å¸Œæœ›å¯ä»¥è¿™æ ·è°ƒç”¨å®ƒï¼š```tsconst curried = curry(a);const step1 = curried(23);         // æ¨å¯¼ä¸º (name: string) =&gt; ...const step2 = step1(&#x27;Alice&#x27;);      // æ¨å¯¼ä¸º (gender: 0 | 1) =&gt; ...const result = step2(0);           // æœ€ç»ˆ result æ˜¯ string ç±»å‹\n\n\nâœ… æœ€ç»ˆå®ç°è¿™æ®µä»£ç çš„å…³é”®æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\nç±»å‹å®šä¹‰ï¼šæˆ‘ä»¬è¦è®© TypeScript èƒ½å¤Ÿè‡ªåŠ¨æ¨å¯¼æ¯ä¸€å±‚å‚æ•°çš„ç±»å‹ï¼›\nè¿è¡Œæ—¶é€»è¾‘ï¼šè¦åœ¨æ¯æ¬¡è°ƒç”¨æ—¶åˆ¤æ–­å‚æ•°æ˜¯å¦æ”¶é›†å®Œï¼Œè‹¥æœªå®Œæˆï¼Œåˆ™è¿”å›ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n// ç±»å‹å®šä¹‰type Curried&lt;A extends any[], R&gt; =   A extends [] ? () =&gt; R :  A extends [infer F] ? (x: F) =&gt; R :  A extends [infer F, ...infer Rest] ? (x: F) =&gt; Curried&lt;Rest, R&gt; :  never;// å‡½æ•°å®ç°function curry&lt;A extends any[], R&gt;(fn: (...args: A) =&gt; R): Curried&lt;A, R&gt; &#123;  return function curried(...args: any[]): any &#123;    if (args.length &gt;= fn.length) &#123;      return fn(...args as A);    &#125; else &#123;      return (...next: any[]) =&gt; curried(...args, ...next);    &#125;  &#125; as Curried&lt;A, R&gt;;&#125;\n\n\næ³¨æ„ï¼šas Curried&lt;A, R&gt; æ˜¯å…³é”®çš„ä¸€æ­¥ç±»å‹æ–­è¨€ï¼Œç”¨äºè®©æœ€ç»ˆè¿”å›å€¼æ‹¥æœ‰æ­£ç¡®çš„ç±»å‹æç¤ºã€‚\n\n\nğŸ§  ç±»å‹æ¨å¯¼åŸç†è§£ææˆ‘ä»¬æ¥çœ‹ Curried çš„ç±»å‹å®šä¹‰ï¼š\ntype Curried&lt;A extends any[], R&gt; =   A extends [] ? () =&gt; R :  A extends [infer F] ? (x: F) =&gt; R :  A extends [infer F, ...infer Rest] ? (x: F) =&gt; Curried&lt;Rest, R&gt; :  never;\n\n\nA æ˜¯ä¸€ä¸ªå‚æ•°æ•°ç»„ç±»å‹ï¼Œä¾‹å¦‚ [number, string, boolean]ã€‚\nå¦‚æœæ˜¯ç©ºæ•°ç»„ï¼Œè¿”å› () =&gt; Rã€‚\nå¦‚æœæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè¿”å› (x: å‚æ•°ç±»å‹) =&gt; Rã€‚\nå¦åˆ™é€’å½’è¿”å› (x: ç¬¬ä¸€ä¸ªå‚æ•°) =&gt; æŸ¯é‡ŒåŒ–å‰©ä¸‹çš„å‚æ•°ã€‚\n\nè¿™å°±å®ç°äº†ç±»å‹å±‚é¢ä¸Šçš„â€œå‚æ•°åˆ†å‘â€ã€‚\n\nğŸš€ ä½¿ç”¨ç¤ºä¾‹æˆ‘ä»¬å†å›å¤´çœ‹çœ‹æœ€åˆçš„ç¤ºä¾‹ï¼Œçœ‹çœ‹ TypeScript èƒ½å¦æ­£ç¡®æ¨å¯¼ç±»å‹ï¼š\nfunction a(age: number, name: string, gender: 0 | 1) &#123;  return `$&#123;name&#125; is $&#123;age&#125; years old, gender: $&#123;gender === 0 ? &#x27;Female&#x27; : &#x27;Male&#x27;&#125;`;&#125;const curried = curry(a);const fn1 = curried(18);         // æ¨å¯¼ä¸º (name: string) =&gt; ...const fn2 = fn1(&#x27;Bob&#x27;);          // æ¨å¯¼ä¸º (gender: 0 | 1) =&gt; ...const result = fn2(1);           // æ¨å¯¼ä¸º stringconsole.log(result); // &quot;Bob is 18 years old, gender: Male&quot;\n\nTypeScript å…¨ç¨‹éƒ½èƒ½æ­£ç¡®æç¤ºå‚æ•°ç±»å‹ âœ…ã€‚\n\nğŸ§© è¡¥å……æ€è€ƒï¼šæŸ¯é‡ŒåŒ–çš„æ„ä¹‰ï¼ŸæŸ¯é‡ŒåŒ–çš„ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯å‚æ•°å¤ç”¨å’Œå‡½æ•°ç»„åˆï¼š\nconst withAge18 = curried(18);const withAge18AndNameTom = withAge18(&#x27;Tom&#x27;);console.log(withAge18AndNameTom(0)); // &quot;Tom is 18 years old, gender: Female&quot;\n\nè¿™ç§â€œé¢„è®¾éƒ¨åˆ†å‚æ•°â€çš„æ–¹å¼ï¼Œåœ¨è¡¨å•å¤„ç†ã€é…ç½®å‡½æ•°ã€äº‹ä»¶ç»‘å®šç­‰åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚\n\nğŸ§± æ€»ç»“\næˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ”¯æŒå®Œæ•´ç±»å‹æ¨å¯¼çš„ curry å‡½æ•°ï¼›\nåˆ©ç”¨äº† TypeScript çš„æ¡ä»¶ç±»å‹ã€é€’å½’ç±»å‹ç­‰é«˜çº§æŠ€å·§ï¼›\nåœ¨å¤šä¸ªå‚æ•°çš„å‡½æ•°ä¸­ï¼Œä¹Ÿèƒ½é€å±‚ä¼ å‚å¹¶å¾—åˆ°è‰¯å¥½çš„ç±»å‹æç¤ºï¼›\næŸ¯é‡ŒåŒ–æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å®é™…å¼€å‘ä¸­ä¹Ÿæœ‰ä¸å°‘è½åœ°åœºæ™¯ã€‚\n\nå¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œä¸å¦¨ç‚¹èµ + æ”¶è—ï¼Œä¸€èµ·æ¢ç´¢æ›´å¤š TypeScript é­”æ³• âœ¨\n","tags":["typescript","å‡½æ•°å¼ç¼–ç¨‹","æŸ¯é‡ŒåŒ–","é«˜é˜¶å‡½æ•°"]},{"title":"è§£ætiff","url":"/2025/07/16/%E8%A7%A3%E6%9E%90tiff/","content":"æ ¸å¿ƒåŸç†å’Œæµç¨‹è¯»å–æ–‡ä»¶ç¼“å†²åŒº   const buffer = fs.readFileSync(filePath);const tiff = await GeoTIFF.fromArrayBuffer(buffer.buffer);const image = await tiff.getImage();\n\n\nç”¨ fs.readFileSync åŒæ­¥è¯»å–æ•´ä¸ª .tif/.tiff äºŒè¿›åˆ¶å†…å®¹åˆ°å†…å­˜ã€‚\nGeoTIFF.fromArrayBuffer å°†è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®è§£ææˆä¸€ä¸ª TIFF å¯¹è±¡ï¼Œå†…éƒ¨ä¼šè¯»å– TIFF å¤´ã€IFDï¼ˆå›¾åƒæ–‡ä»¶ç›®å½•ï¼‰ç­‰ç»“æ„ã€‚\ngetImage() æ‹¿åˆ°ç¬¬ä¸€ä¸ªå½±åƒå¸§ï¼ˆTIFF å¯ä»¥åŒ…å«å¤šå¸§ï¼Œä½†æˆ‘ä»¬é€šå¸¸åªå…³å¿ƒç¬¬ä¸€ä¸ªå›¾å±‚ï¼‰ã€‚\n\nè·å–æ …æ ¼å°ºå¯¸   const width = image.getWidth();const height = image.getHeight();\n\n\nç›´æ¥ä» TIFF å…ƒæ•°æ®é‡Œè¯»å‡ºæ …æ ¼å®½é«˜ï¼Œç”¨äºåç»­çš„åƒç´ éå†å’Œç”»å¸ƒåˆ›å»ºã€‚\n\nè§£æåœ°ç†å‚è€ƒä¿¡æ¯ï¼ˆTiePoints + PixelScaleï¼‰   const tiePoints = image.getTiePoints();const scale = image.getFileDirectory().ModelPixelScale;const originX = tiePoints[0].x;const originY = tiePoints[0].y;const [pixelSizeX, pixelSizeY] = scale;\n\n\nTiePointsï¼šä¸€å¯¹æˆ–å¤šå¯¹åƒç´ åæ ‡ â†” åœ°ç†åæ ‡ï¼ˆé€šå¸¸åªæœ‰ä¸€å¯¹ï¼‰ï¼Œå‘Šè¯‰æˆ‘ä»¬å½±åƒå·¦ä¸Šè§’ï¼ˆæˆ–æŸä¸ªåƒç´ ï¼‰çš„åœ°å›¾æŠ•å½±åæ ‡ã€‚\nModelPixelScaleï¼šæ¯ä¸ªåƒç´ åœ¨æŠ•å½±åæ ‡ç³»ä¸‹çš„çœŸå®é•¿åº¦ï¼ˆXã€Y æ–¹å‘ï¼‰ã€‚\nç”±æ­¤ï¼Œå°±èƒ½ç®—å‡ºæ•´å¼ å½±åƒåœ¨æŠ•å½±åæ ‡ç³»ä¸‹çš„è¾¹ç•Œï¼š- å·¦ä¸‹è§’ (minX, minY)- å³ä¸Šè§’ (maxX, maxY)\n\nè¯»å–æŠ•å½±ï¼ˆEPSGï¼‰ä¿¡æ¯   const geoKeys = image.getGeoKeys();const epsgCode = geoKeys.ProjectedCSTypeGeoKey || geoKeys.GeographicTypeGeoKey;const sourceCrs = `EPSG:$&#123;epsgCode&#125;`;\n\n\nGeoKeys ä¸­å­˜ç€ TIFF é‡Œè®°å½•çš„æŠ•å½±ä»£ç ï¼Œæ¯”å¦‚ 3857ã€4326 ç­‰ã€‚\næ‹¼æˆ EPSG:XXXX å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿åç»­ç”¨ proj4 åšåæ ‡è½¬æ¢ã€‚\n\næŠ•å½±åæ ‡ â†’ åœ°ç†åæ ‡ï¼ˆç»çº¬åº¦ï¼‰   const transformer = proj4(sourceCrs, &#x27;EPSG:4326&#x27;);const [minLon, minLat] = transformer.forward([minX, minY]);const [maxLon, maxLat] = transformer.forward([maxX, maxY]);\n\n\nç”¨ proj4 åœ¨ä¸åŒ CRSï¼ˆå¦‚ WebMercatorã€UTMï¼‰ä¹‹é—´æ— ç¼æŠ•å½±è½¬æ¢ã€‚\nå°†å››ä¸ªè§’çš„æŠ•å½±åæ ‡è½¬æ¢åˆ° WGS84ï¼ˆEPSG:4326ï¼‰ä¸‹çš„ç»çº¬åº¦ã€‚\n\nè¯»å–åƒç´ æ …æ ¼å¹¶å‡†å¤‡æ¸²æŸ“   const rasters = await image.readRasters(&#123; interleave: true &#125;);const rasterData = rasters instanceof Uint8ClampedArray  ? rasters  : new Uint8ClampedArray(rasters as unknown as Uint8Array);\n\n\nreadRasters(&#123; interleave: true &#125;) ä¼šä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰æ³¢æ®µæ•°æ®å¹¶æŒ‰ RGBAã€ç°åº¦ç­‰æ ¼å¼æ’åˆ—ã€‚\nCanvas çš„ ImageData è¦æ±‚åº•å±‚æ•°æ®æ˜¯ Uint8ClampedArrayï¼Œæ‰€ä»¥è¿™é‡Œåšäº†ç±»å‹å…¼å®¹è½¬æ¢ã€‚\n\nåœ¨ Canvas ä¸Šç»˜åˆ¶æ …æ ¼   const canvas = createCanvas(width, height);const ctx = canvas.getContext(&#x27;2d&#x27;);const imgData = ctx.createImageData(width, height);imgData.data.set(rasterData);ctx.putImageData(imgData, 0, 0);\n\n\ncreateCanvas æ ¹æ®å½±åƒå°ºå¯¸æ–°å»ºå†…å­˜ç”»å¸ƒã€‚\nç”¨ createImageData æ–°å»ºä¸€ä¸ªç©ºç™½çš„åƒç´ ç¼“å†²åŒºï¼Œdata.set(...) å°†æ …æ ¼æ•°æ®å†™å…¥ï¼Œå†ä¸€å£æ°”ç»˜åˆ¶åˆ°ç”»å¸ƒã€‚\n\nå¯¼å‡ºä¸ºå›¾ç‰‡æ–‡ä»¶   const outPath = filePath.replace(/\\.(tif|tiff)$/i, &#x27;.png&#x27;);fs.writeFileSync(outPath, canvas.toBuffer(&#x27;image/png&#x27;));fs.writeFileSync(outPath, webpBuffer);\n\n\ncanvas.toBuffer(&#39;image/png&#39;) ä¼šè°ƒç”¨åº•å±‚çš„å›¾åƒåº“ï¼ˆå¦‚ libvips æˆ– Cairoï¼‰å°†ç”»å¸ƒå†…å®¹ç¼–ç ä¸º PNG æ ¼å¼ã€‚\næœ€åå†™ç£ç›˜ç”Ÿæˆ .png æ–‡ä»¶ã€‚\n\nè¿”å›ç»¼åˆå…ƒä¿¡æ¯   return &#123;  width, height,  sourceCrs,  bboxSource: &#123; minX, minY, maxX, maxY &#125;,  bboxLatLng: &#123; minLat, minLon, maxLat, maxLon &#125;,  geoKeys,  webp: outPath&#125;;\n\n\nå°†æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼ˆåŸå§‹æŠ•å½±åæ ‡è¾¹ç•Œã€åœ°ç†åæ ‡è¾¹ç•Œã€è¾“å‡ºæ–‡ä»¶è·¯å¾„ç­‰ï¼‰æ‰“åŒ…è¿”å›ï¼Œæ–¹ä¾¿åç»­è‡ªåŠ¨åŒ–æµæ°´çº¿ä½¿ç”¨æˆ–è®°å½•ã€‚\n\n\næ ¸å¿ƒæ€è·¯ï¼š\nè§£æ TIFF å…ƒæ•°æ® è·å–æŠ•å½±ã€åœ°ç†å®šä½ä¿¡æ¯ï¼ˆTiePoints + Scale + GeoKeysï¼‰ï¼›\nè½¬æ¢åæ ‡ å¾—åˆ°äººç±»æ˜“è¯»çš„ç»çº¬åº¦ï¼›\nè¯»å–å¹¶å¯è§†åŒ–å½±åƒ æ„å»º Canvasï¼Œæ¸²æŸ“æˆæ ‡å‡†å›¾åƒæ ¼å¼ï¼›\nè¾“å‡ºæ–‡ä»¶å’Œå…ƒæ•°æ® ä¾›åç»­ä½¿ç”¨ã€‚\n\nè¿™æ ·ï¼Œä½ å°±èƒ½åœ¨çº¯ Node.js ç¯å¢ƒä¸‹ï¼Œå®ç°å¯¹ä»»ä½• GeoTIFF æ–‡ä»¶çš„â€œè¯»æŠ•å½±ã€ç®—èŒƒå›´ã€å‡ºå›¾ç‰‡â€è¿™ä¸€æ•´å¥—æµç¨‹ã€‚\n\nå®Œæ•´ä»£ç /* * Node.js script to read a GeoTIFF (.tif/.tiff), extract its projection, * compute geographic bounding box, and render the raster to a PNG image. * * Dependencies: *   npm install geotiff proj4 canvas */import fs from &#x27;fs&#x27;;import * as GeoTIFF from &#x27;geotiff&#x27;;import proj4 from &#x27;proj4&#x27;;import &#123; createCanvas &#125; from &#x27;canvas&#x27;;async function parseGeoTIFF(filePath: string) &#123;  // 1. Read file into buffer  const buffer = fs.readFileSync(filePath);  // 2. Parse the GeoTIFF  const tiff = await GeoTIFF.fromArrayBuffer(buffer.buffer);  const image = await tiff.getImage();  // 3. Image dimensions  const width = image.getWidth();  const height = image.getHeight();  // 4. Geo tie points &amp; pixel scale  const tiePoints = image.getTiePoints();  const scale = image.getFileDirectory().ModelPixelScale;  if (!tiePoints.length || !scale) &#123;    throw new Error(&#x27;Missing geo-referencing tags (tie points or pixel scale)&#x27;);  &#125;  const &#123; x: originX, y: originY &#125; = tiePoints[0];  const [pixelSizeX, pixelSizeY] = scale;  // 5. Compute bounding box in source CRS  const minX = originX;  const maxY = originY;  const maxX = originX + width * pixelSizeX;  const minY = originY - height * pixelSizeY;  // 6. Projection info (EPSG code)  const geoKeys = image.getGeoKeys();  const epsgCode = geoKeys.ProjectedCSTypeGeoKey || geoKeys.GeographicTypeGeoKey;  const sourceCrs = EPSG:$&#123;epsgCode&#125;;  // 7. Transform corners to WGS84 (lat/lon)  const transformer = proj4(sourceCrs, &#x27;EPSG:4326&#x27;);  const [minLon, minLat] = transformer.forward([minX, minY]);  const [maxLon, maxLat] = transformer.forward([maxX, maxY]);  // 8. Read raster data (interleaved)  const rastersRaw = await image.readRasters(&#123; interleave: true &#125;);  // Convert to Uint8ClampedArray for ImageData  const rasterData =    rastersRaw instanceof Uint8ClampedArray      ? rastersRaw      : new Uint8ClampedArray(rastersRaw as any);  // 9. Render to canvas  const canvas = createCanvas(width, height);  const ctx = canvas.getContext(&#x27;2d&#x27;);  const imgData = ctx.createImageData(width, height);  imgData.data.set(rasterData);  ctx.putImageData(imgData, 0, 0);  // 10. Save PNG  const outPath = filePath.replace(/\\.(tif|tiff)$/i, &#x27;.png&#x27;);  fs.writeFileSync(outPath, canvas.toBuffer(&#x27;image/png&#x27;));  // 11. Return metadata  return &#123;    width,    height,    sourceCrs,    bboxSource: &#123; minX, minY, maxX, maxY &#125;,    bboxLatLng: &#123; minLat, minLon, maxLat, maxLon &#125;,    geoKeys,    png: outPath  &#125;;&#125;// Example usage:(async () =&gt; &#123;  try &#123;    const result = await parseGeoTIFF(process.argv[2]);    console.log(&#x27;Parsed GeoTIFF metadata:&#x27;);    console.log(JSON.stringify(result, null, 2));  &#125; catch (err) &#123;    console.error(&#x27;Error parsing GeoTIFF:&#x27;, err);  &#125;&#125;)();\n","tags":["GIS","tiff"]}]